<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>공지사항</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="./css/reset.css" rel="stylesheet">
    <link href="./css/styles.css" rel="stylesheet" />
    <link href="./css/basic.css" rel="stylesheet" />
    <style>
      * {
        margin:0;
        padding:0;
        font-family:Verdana,sans-serif;
        box-sizing:border-box;
        }

        body {color:#333;font-size:14px;}
        #wrap {
            width:1200px;
            margin: 0 auto;
        }
        /* table, ul */
        table {width:100%;border:0; border-collapse:collapse;}
        th,td {padding:8px 0;vertical-align:middle}
        th {text-align:left;}
        ul, li {margin:0;padding:0;list-style:none;}
        /* input */
        input[type=text] {display:inline-block;width:100%;height:32px;padding:0 10px;border:1px solid #ccc;font-size:14px;}
        textarea {
            display:inline-block;
            width:100%;
            height: 400px;
            padding:10px;
            border:1px solid #ccc;
            font-size:16px;
            
        }
        input[type=button],input[type=submit], button {border:0;font-size:14px;}
        /* button */
        .btn-wrap {margin:10px 0 0 0;text-align:right}
        .btn {display:inline-block;padding:12px 20px;background-color:#333;color:#fff;text-align:center;line-height:1;}
        .back.btn{background-color: #fff; border: 1px solid #aaa;color: #343434; box-sizing: border-box;}
        .result {padding:15px;background-color:#eee;}
        .result + .result {border-top:1px solid #ccc;}
        .result ul {position:relative;overflow:hidden;}
        .result li:nth-child(1),
        .result li:nth-child(2) {float:right;color:#999;font-size:12px}
        .result li:nth-child(1) {padding-left:8px}
        .result li:nth-child(3) {font-weight:bold;}

        fieldset {
            padding:16px; 
            margin: 40px 0;
        }
        legend {display:none}
        .cont {overflow:hidden;height:27px;}
        .commtIptBox {
        display:flex;
        display: -webkit-flex;
        flex-wrap: wrap;
        -webkit-flex-wrap: wrap;
        padding-top:20px;
        }
        .commtBox {flex:0 0 100%;font-size:12px;padding:10px 8px 0}
        .contTxtBox {padding:10px 0 0;}
        #btnCommt {display:block;flex:0 0 60px;height:32px;margin-left:8px;background:#666;color:#fff;line-height:1;}
        #btnCommtInput {flex:1}
        #btnCommtName {flex:0 0 100px;margin-right:8px}
        .count {display:inline-block;margin-left:8px;font-style:normal;font-weight:bold;color:blue}

    </style>
  </head>
  <body>
    <div class="fixed_k_startup">
      <a href="https://www.k-startup.go.kr/" target="_blank">
          <div class="img_box">
              <img src="./assets/k-startup.png" alt="">
          </div>
      </a>
    </div>
    <main>
        <nav class="navbar navbar-expand-lg bg-white">
          <div class="container px-5">
            <a href="index.html">
                <img src="./assets/logo.png" alt="" class="navbar-logo">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link pr-3 pl-3 d-block" href="greetings.html">센터소개</a>
                        <ul class="sub-menu">
                            <li>
                                <a href="greetings.html">센터장 인사말</a>
                            </li>
                            <li>
                                <a href="group.html">조직도</a>
                            </li>
                            <li>
                                <a href="space.html">공간안내</a>
                            </li>
                            <li>
                                <a href="address.html">오시는 길</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link pr-3 pl-3 d-block" href="about.html">지원서비스</a>
                        <ul class="sub-menu">
                            <li>
                                <a href="#none">창업교육</a>
                            </li>
                            <li>
                                <a href="#none">창업 멘토링</a>
                            </li>
                            <li>
                                <a href="#none">멘토링 신청</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link pr-3 pl-3 d-block" href="contact.html">입주</a>
                        <ul class="sub-menu">
                            <li>
                                <a href="information.html">입주안내</a>
                            </li>
                            <li>
                                <a href="#none">입주기업현황</a>
                            </li>
                            <li>
                                <a href="#none">졸업기업현황</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link pr-3 pl-3 d-block" href="pricing.html">정보 게시판</a>
                        <ul class="sub-menu">
                            <li>
                                <a href="#none">공지사항</a>
                            </li>
                            <li>
                                <a href="#none">보도자료</a>
                            </li>
                            <li>
                                <a href="#none">사업공고</a>
                            </li>
                            <li>
                                <a href="#none">활동갤러리</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
          </div>
        </nav>

        <!--배너 -->
        <div id="carouselExampleIndicators" class="carousel slide">
          <div class="carousel-inner">
            <div class="sub_page active">
              <a href="#none">
                  <img src="./assets/상세페이지.jpg" class="d-block w-100" alt="...">
              </a>
            </div>
            <div class="carousel-caption d-none d-md-block">
              <h3 class="mb-5">정보게시판</h3>
              <h1>글쓰기</h1>
            </div>
          </div>
        </div>

        <!-- 게시글 생성부분 -->
        <div id="wrap">
            <div id="resultWrap"></div>
          
            <fieldset>
              <legend>board</legend>
              <form id="frm1">
          
                <table>
                  <caption></caption>
                  <colgroup>
                    <col style="width:100px" />
                  </colgroup>
                  <tbody>
                    <tr>
                      <th scope="row">작성자</th>
                      <td><input type="text" id="iptName" value="" /></td>
                    </tr>
                    <tr>
                      <th scope="row">제목</th>
                      <td><input type="text" id="iptTitle" value="" /></td>
                    </tr>
                    <tr>
                      <th scope="row">내용</th>
                      <td><textarea id="iptCont" rows="5" cols="10"></textarea></td>
                    </tr>
                    <tr>
                        <th scope="row">첨부 파일</th>
                        <td><input class="form-control1" id="file" type="file" multiple></td>
                      </tr>
                  </tbody>
                </table>
                <div class="btn-wrap">
                    <input type="button" id="back_btn" class="btn back" value="취소">
                    <input type="button" id="btnRegist" class="btn" value="업로드">
                </div>
              </form>
              
            </fieldset>
        </div>
            
            
    </main>
    <footer class="bg-dark py-4 mt-auto">
      <div class="container px-5">
          <div class="row align-items-center justify-content-between flex-column flex-sm-row">
              <div class="col-auto"><div class="small m-0 text-white">Copyright &copy; 충남 서부권 중장년기술창업센터 2024</div></div>
              <div class="col-auto">
                  <a class="link-light small mr-3" href="https://www.facebook.com/profile.php?id=100075705774887&locale=ko_KR" target="_blank">
                      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
                          <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951"/>
                        </svg>
                  </a>
                  <a class="link-light small" href="https://www.instagram.com/hanseo.m.startup/" target="_blank">
                      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-instagram" viewBox="0 0 16 16">
                          <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.9 3.9 0 0 0-1.417.923A3.9 3.9 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.9 3.9 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.9 3.9 0 0 0-.923-1.417A3.9 3.9 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599s.453.546.598.92c.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.5 2.5 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.5 2.5 0 0 1-.92-.598 2.5 2.5 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233s.008-2.388.046-3.231c.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92s.546-.453.92-.598c.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92m-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217m0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334"/>
                      </svg>
                  </a>
              </div>
          </div>
      </div>
    </footer>

  <!-- 파베 관련 JS -->
  <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-firestore.js"></script>   
  <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-storage.js"></script> 
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

  <script>
      const firebaseConfig = {
      apiKey: "AIzaSyCLHolAddBBQWNdlxM0hIDaiIilxo9CytI",
      authDomain: "chungnamws.firebaseapp.com",
      databaseURL: "https://chungnamws-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "chungnamws",
      storageBucket: "chungnamws.appspot.com",
      messagingSenderId: "440901868102",
      appId: "1:440901868102:web:0d0fc409237c4ab4834847",
      measurementId: "G-1GZ7YCCC8D"         
    };
    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig)
  </script>

  <!-- 커스텀 JS -->
  <!-- <script src="./js/database.js"></script> -->
  
  <script>

    // 날짜불러오기
    const today = new Date();
    let year = today.getFullYear(); // 년도
    let month = today.getMonth() + 1;  // 월
    let date = today.getDate();  // 날짜

    // 데이터 불러오기
    // doc().set() 문서이름 지정
    // add() 문서이름 자동 지정
    const db = firebase.firestore(app);
    const storage = firebase.storage();

    // 간단한 해시 함수로 고유한 숫자 생성
    function generateHash(docId) {
        let hash = 0;
        for (let i = 0; i < docId.length; i++) {
            const char = docId.charCodeAt(i);
            hash = (hash << 5) - hash + char;
            hash = hash & hash; // 비트 연산으로 변환
        }
        return Math.abs(hash) % 10000; // 음수 방지를 위해 절대값으로
    }

    $(document).ready(function(){
        // 폼이벤트 막기
         // 폼 이벤트 막기 및 폼 데이터 처리
    $('#frm1').on("submit", function(event) {
        event.preventDefault();  // 폼 제출 시 페이지 새로고침 방지
        console.log('폼이 제출되었습니다!');
        // 여기에 AJAX 요청이나 폼 데이터를 처리하는 로직을 추가할 수 있습니다.
    });

    // 데이터 전송 버튼 클릭 이벤트
    $('#btnRegist').on('click', function(event) {
        event.preventDefault();  // 기본 동작 방지

        
        var title = $("#iptTitle").val();
        var name = $("#iptName").val();
        var timestamp =firebase.firestore.FieldValue.serverTimestamp();
        var content = $("#iptCont").val();
        var time = year + '/' + month + '/' + date

        // 스토리지 변수지정
        var storageRef = storage.ref();

        // 인풋에 넣은 파일 찾기
        var files = document.querySelector("#file").files;
      
    // 업로드 상태를 추적할 Promise 배열 생성
        var uploadPromises = [];

        if(title == ""){
            return alert("제목을 입력해주세요")
        }
        if(name == ""){
            return alert("작성자를 입력해주세요")
        }
        if(content == ""){
            return alert("내용을 입력해주세요")
        }

        // 파일을 배열로 변환 후 각각 업로드 처리
        Array.from(files).forEach((file) => {
            // 각 파일을 Firebase Storage에 저장할 경로 설정
            var fileRef = storageRef.child('uploads/' + file.name);

            // 파일 업로드 및 Promise 저장
            var uploadTask = fileRef.put(file);

            // 업로드 작업을 Promise로 변환하여 배열에 저장
            var uploadPromise = new Promise((resolve, reject) => {
                uploadTask.on('state_changed',
                    function progress(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        console.log('업로드 진행 상황: ' + progress + '%');
                    },
                    function error(err) {
                        console.error("업로드 중 오류 발생: ", err);
                        reject(err);  // 오류 시 Promise 거부
                    },
                    function complete() {
                        // 업로드 완료 후 다운로드 URL 가져오기
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            resolve(downloadURL);  // 성공 시 Promise 해결

                            var save = {
                                title: title,
                                create_admin: name,
                                content: content,
                                date: time,  // 예: 작성된 시간
                                createdAt: timestamp,
                                file:downloadURL  // 타임스탬프
                            }
                            db.collection("posts").add(save).then((docRef) => {
                                const no = generateHash(docRef.id);  // 문서 ID로부터 고유 번호 생성
                                docRef.update({ no: no });  // 생성된 번호를 문서에 업데이트
                                console.log("게시글이 성공적으로 추가되었습니다. 번호:", no);
                                
                            }).catch((error) => {
                                console.error("게시글 추가 중 오류 발생: ", error);
                            });

                        });
                    }
                );
            });

            // Promise 배열에 추가
            uploadPromises.push(uploadPromise);
        });
       
          
        
        
       
       
         // 모든 파일 업로드 완료 후 페이지 전환
        Promise.all(uploadPromises).then(function(downloadURLs) {
            alert('글이 업로드 되었습니다.', downloadURLs);
            // 업로드가 모두 완료되었을 때 페이지 이동
            window.location.href = "notice_board.html";
        }).catch(function(error) {
            console.error('파일 업로드 중 오류 발생:', error);
            alert('파일 업로드 중 오류가 발생했습니다. 다시 시도해주세요.');
        });
        
    });

    // 뒤로 가기 버튼 클릭 이벤트
    $('#back_btn').on('click', function(event) {
        event.preventDefault();  // 기본 동작 방지
        console.log('취소 버튼이 클릭되었습니다!');
        // 뒤로 가기나 다른 페이지로 이동하는 동작 추가
        window.location.href = "notice_board.html";  // 브라우저의 뒤로 가기 동작
    });

    })
    

  </script>
  <!-- main js -->
   <script src="./js/main.js"></script>
  </body>
</html>
